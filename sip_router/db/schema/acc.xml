<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE table PUBLIC "-//iptel.org//DTD DBSchema V1.0//EN" 
  "http://iptel.org/dbschema/dtd/1.0/dbschema.dtd" [

<!ENTITY % entities SYSTEM "entities.xml">
%entities;

]>

<table xmlns:db="http://docbook.org/ns/docbook"
    xmlns:my="http://iptel.org/dbschema/mysql"
    xmlns:pg="http://iptel.org/dbschema/postgres"
    xmlns:dt="http://iptel.org/dbschema/dbtext">
    <name>acc</name>
    <description>
	<db:para>
	    Acc table is used for accounting purposes. When configured to account
	    transactions, SER will write one row per transaction into this
	    table. The table is never read by SER, SER only writes into this
	    table. SERWeb can query the table to display the list of placed calls.
	</db:para>
	<db:para>
	    SER records sucessful transactions (those replied with a 2xx final
	    response) into this table. SER never reads or updates rows in the
	    table, it only inserts new rows into the table. This table can
	    potentially get big. There will be 1-3 rows per call, depending on
	    the configuration of SER. 
	</db:para>
	<db:para>
	    SERWeb queries the table when displaying the list of placed calls
	    of a subscriber. 
	</db:para>
    </description>
    <version>3</version>

    <column id="acc.id">
	<name>id</name>
	<type>int</type>
	<my:type>INT AUTO_INCREMENT</my:type>
	<pg:type>SERIAL</pg:type>
	<dt:type>int,auto</dt:type>
	<description>
	    ID that uniquely identifies every record. Useful for post-processing.
	</description>
    </column>

    <column>
	<name>from_uid</name>
	<type>string</type>
	<size>&id_len;</size>
	<null/>
	<description>
	    The UID (Unique ID) of the originator of transaction (usually caller).
	</description>
    </column>

    <column>
	<name>to_uid</name>
	<type>string</type>
	<size>&id_len;</size>
	<null/>
	<description>
	    The UUID of the user identified by the Request-URI (intended
	    recipient of the transaction).
	</description>
    </column>

    <column>
	<name>to_did</name>
	<type>string</type>
	<size>&id_len;</size>
	<null/>
	<description>
	    The domain id of the callee.
	</description>
    </column>

    <column>
	<name>from_did</name>
	<type>string</type>
	<size>&id_len;</size>
	<null/>
	<description>
	    The domain id of the caller.
	</description>
    </column>

    <column>
	<name>sip_from</name>
	<type>string</type>
	<size>&hf_len;</size>
	<null/>
	<description>
	    The body of the From header field, including display name and all
	    parameters URI and header field parameters.
	</description>
    </column>

    <column>
	<name>sip_to</name>
	<type>string</type>
	<size>&hf_len;</size>
	<null/>
	<description>
	    The body of the To header field, including display name and all
	    parameters URI and header field parameters.
	</description>
    </column>

    <column>
	<name>sip_status</name>
	<type>string</type>
	<size>128</size>
	<null/>
	<description>
	    The status code of the final SIP reply that finished the
	    transaction being accounted.
	</description>
    </column>

    <column>
	<name>sip_method</name>
	<type>string</type>
	<size>&method_len;</size>
	<null/>
	<description>
	    The method of the SIP request that created the transaction being
	    accounted.
	</description>
    </column>

    <column>
	<name>in_ruri</name>
	<type>string</type>
	<size>&uri_len;</size>
	<null/>
	<description>
	    Inbound Request-URI. This is the value of the Request-URI as
	    received by SER from the previous (upstream) element (typically
	    generated by the SIP phone of the caller).
	</description>
    </column>

    <column>
	<name>out_ruri</name>
	<type>string</type>
	<size>&uri_len;</size>
	<null/>
	<description>
	    Outbound Request-URI. This is the value of the Request-URI when the
	    request leaves SER, i.e. after applying all the modifications and
	    rewrites in the configuration file of SER. The next downstream
	    element (typically the SIP phone of the callee) will see exactly
	    this value of the Request-URI.
	</description>
    </column>

    <column>
	<name>from_uri</name>
	<type>string</type>
	<size>&uri_len;</size>
	<null/>
	<description>
	    The SIP URI extracted from From header field. This is just the
	    plain SIP URI without display name and header field parameters
	    (if From header field contains angle brackets then this
	    column contains the string between the angle brackets).
	</description>
    </column>

    <column>
	<name>to_uri</name>
	<type>string</type>
	<size>&uri_len;</size>
	<null/>
	<description>
	    The SIP URI extracted from To header field. This is just the plain
	    SIP URI without display name and header field parameters (if To
	    header field contains angle brackets then this column contains the
	    string between the angle brackets).
	</description>
    </column>

    <column id="acc.sip_callid">
	<name>sip_callid</name>
	<type>string</type>
	<size>&uri_len;</size>
	<null/>
	<description>
	    The value of the Call-ID header field. This value uniquely
	    identifies a call.
	</description>
    </column>

    <column id="acc.sip_cseq">
	<name>sip_cseq</name>
	<type>int</type>
	<null/>
	<description>
	    CSeq number.
	</description>
    </column>

    <column id="acc.username">
	<name>digest_username</name>
	<type>string</type>
	<size>&user_len;</size>
	<null/>
	<description>
	    The value of username attribute from digest credentials
	</description>
    </column>

    <column id="acc.realm">
	<name>digest_realm</name>
	<type>string</type>
	<size>&uri_len;</size>
	<null/>
	<description>
	    Digest realm.
	</description>
    </column>

    <column>
	<name>from_tag</name>
	<type>string</type>
	<size>128</size>
	<null/>
	<description>
	    The value of the tag parameter in From header field.
	</description>
    </column>

    <column>
	<name>to_tag</name>
	<type>string</type>
	<size>128</size>
	<null/>
	<description>
	    The value of the tag parameter in To header field.
	</description>
    </column>

    <column>
	<name>src_ip</name>
	<type>unsigned int</type>
	<null/>
    </column>

    <column>
	<name>src_port</name>
	<type>unsigned short</type>
	<null/>
    </column>

    <column>
	<name>request_timestamp</name>
	<type>datetime</type>
	<description>
	    The date and time of the request arrival to the proxy.
	</description>
    </column>

    <column>
	<name>response_timestamp</name>
	<type>datetime</type>
	<description>
	    The date and time when the final response was sent out.
	</description>
    </column>

    <column>
	<name>flags</name>
	<type>unsigned int</type>
	<default>0</default>
	<description>
	    Various flags (caller_deleted, callee_deleted).
	</description>
    </column>

    <column>
	<name>attrs</name>
	<type>string</type>
	<size>255</size>
	<null/>
	<description>
	    Attribute-value pairs.
	</description>
    </column>

    <index>
	<name>id_key</name>
	<unique/>
	<colref linkend="acc.id"/>
    </index>

    <index role="serweb">
	<name>cid_key</name>
	<colref linkend="acc.sip_callid"/>
    </index>
</table>
