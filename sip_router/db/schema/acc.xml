<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE table PUBLIC "-//iptel.org//DTD DBSchema V1.0//EN" 
  "http://iptel.org/dbschema/dtd/1.0/dbschema.dtd" [

<!ENTITY % entities SYSTEM "entities.xml">
%entities;

]>

<table xmlns:db="http://docbook.org/ns/docbook" xmlns:my="http://iptel.org/dbschema/mysql">
    <name>acc</name>
    <description>
	<db:para>
	    Acc table is used for accounting purposes. When configured to account
	    transactions, SER will write one row per transaction into this
	    table. The table is never read by SER, SER only writes into this
	    table. SERWeb can query the table to display the list of placed
	    calls.
	</db:para>
	<db:para>
	    SER records sucessful transactions (those replied with a 2xx final
	    response) into this table. SER never reads or updates rows in the
	    table, it only inserts new rows into the table. This table can
	    potentially get big. There will be 1-3 rows per call, depending on
	    the configuration of SER. 
	</db:para>
	<db:para>
	    SERWeb queries the table when displaying the list of placed calls
	    of a subscriber. 
	</db:para>
    </description>
    <version>2</version>

    <column>
	<name>caller_UUID</name>
	<type>string</type>
	<size>&uuid_len;</size>
	<description>
	    The UUID of the user identified by From header field (the
	    initiator of the transaction).
	</description>
    </column>

    <column>
	<name>callee_UUID</name>
	<type>string</type>
	<size>&uuid_len;</size>
	<description>
	    The UUID of the user identified by the Request-URI (intended recipient of the
	    transaction).
	</description>
    </column>

    <column>
	<name>sip_from</name>
	<type>string</type>
	<size>&hf_len;</size>
	<description>
	    The body of the From header field, including display name and all
	    parameters URI and header field parameters.
	</description>
    </column>

    <column>
	<name>sip_to</name>
	<type>string</type>
	<size>&hf_len;</size>
	<description>
	    The body of the To header field, including display name and all
	    parameters URI and header field parameters.
	</description>
    </column>

    <column>
	<name>sip_status</name>
	<type>string</type>
	<size>128</size>
	<description>
	    The status code of the final SIP reply that finished the
	    transaction being accounted.
	</description>
    </column>

    <column>
	<name>sip_method</name>
	<type>string</type>
	<size>&method_len;</size>
	<description>
	    The method of the SIP request that created the transaction being
	    accounted.
	</description>
    </column>

    <column>
	<name>i_uri</name>
	<type>string</type>
	<size>&uri_len;</size>
	<description>
	    Inbound Request-URI. This is the value of the Request-URI as
	    received by SER from the previous (upstream) element (typically
	    generated by the SIP phone of the caller).
	</description>
    </column>

    <column>
	<name>o_uri</name>
	<type>string</type>
	<size>&uri_len;</size>
	<description>
	    Outbound Request-URI. This is the value of the Request-URI when the
	    request leaves SER, i.e. after applying all the modifications and
	    rewrites in the configuration file of SER. The next downstream
	    element (typically the SIP phone of the callee) will see exactly
	    this value of the Request-URI.
	</description>
    </column>

    <column>
	<name>from_uri</name>
	<type>string</type>
	<size>&uri_len;</size>
	<description>
	    The SIP URI extracted from From header field. This is just the
	    plain SIP URI without display name and header field parameters
	    (if From header field contains angle brackets then this
	    column contains the string between the angle brackets).
	</description>
    </column>

    <column>
	<name>to_uri</name>
	<type>string</type>
	<size>&uri_len;</size>
	<description>
	    The SIP URI extracted from To header field. This is just the plain
	    SIP URI without display name and header field parameters (if To
	    header field contains angle brackets then this column contains the
	    string between the angle brackets).
	</description>
    </column>

    <column id="sip_callid">
	<name>sip_callid</name>
	<type>string</type>
	<size>&uri_len;</size>
	<description>
	    The value of the Call-ID header field. This value uniquely
	    identifies a call.
	</description>
    </column>

    <column id="username">
	<name>username</name>
	<type>string</type>
	<size>&user_len;</size>
	<description>
	    The value of username attribute from digest credentials. If a message does
	    not contain digest credentials then From header field username is used.
	</description>
    </column>

    <column id="domain">
	<name>domain</name>
	<type>string</type>
	<size>&domain_len;</size>
	<description>
	    In multi-domain setups (SER handling more than one virtual domain)
	    this is the domain the transaction was processed in.
	</description>
    </column>

    <column>
	<name>fromtag</name>
	<type>string</type>
	<size>128</size>
	<description>
	    The value of the tag parameter in From header field.
	</description>
    </column>

    <column>
	<name>totag</name>
	<type>string</type>
	<size>128</size>
	<description>
	    The value of the tag parameter in To header field.
	</description>
    </column>

    <column>
	<name>time</name>
	<type>datetime</type>
	<default>1970-01-01 00:00:00</default>
	<description>
	    The time of the completion of the transaction (the time of
	    forwarding of the final reply upstream by SER).
	</description>
    </column>

    <column>
	<name>timestamp</name>
	<type>datetime</type>
	<default>1970-01-01 00:00:00</default>
	<description>
	    Timestamp auto-generated by the database server.
	</description>
    </column>

    <column>
	<name>caller_deleted</name>
	<type>char</type>
	<default>0</default>
	<description>
	    A flag that will be set to 1 when the caller deleted this record in
	    his accounting list in SERWeb. The row can be deleted from acc
	    table once both caller_deleted and callee_delete flags are set to 1.
	</description>
    </column>

    <column>
	<name>callee_deleted</name>
	<type>char</type>
	<default>0</default>
	<description>
	    A flag that will be set to 1 when the caller deleted this record in
	    his accounting list in SERWeb. The row can be deleted from acc
	    table once both caller_deleted and callee_delete flags are set to 1.
	</description>
    </column>

    <index>
	<name>acc_user</name>
	<colref linkend="username"/>
	<colref linkend="domain"/>
    </index>

    <index>
	<name>sip_callid</name>
	<colref linkend="sip_callid"/>
    </index>
</table>
